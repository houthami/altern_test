<div class="page-header">
  <h1 class="text-center">Liste des produits</h1>

  <p-button
    label="CrÃ©er produit"
    (onClick)="onCreate()"
    class="block text-center"
  />
</div>

<p-dataView #dv [value]="products()">
  <ng-template pTemplate="list" let-products>
    <div class="product-grid">
      @for (product of products; track product) {
      <p-card class="product-card">
        <div class="product-header">
          <img
            [src]="product.image || 'assets/img/default-product.jpg'"
            (error)="handleImageError($event)"
            alt="{{ product.name }}"
            class="product-image"
          />
        </div>
        <div class="product-content">
          <p-tag
            [value]="product.category"
            [severity]="getSeverity(product.category)"
            class="product-category"
          ></p-tag>
          <div class="product-title">
            <h3 class="product-name">{{ product.name }}</h3>
            <div
              *ngIf="product.inventoryStatus !== 'INSTOCK'"
              [class]="getStatusClass(product.inventoryStatus)"
            >
              {{ product.inventoryStatus }}
            </div>
          </div>
          <div class="product-description">{{ product.description }}</div>
          <div class="product-info">
            <div class="product-price">{{ product.price | currency }}</div>
            <div class="product-rating">
              @for (star of [1,2,3,4,5]; track star) {
              <i
                class="pi"
                [ngClass]="star <= product.rating ? 'pi-star-fill' : 'pi-star'"
              ></i>
              }
            </div>
          </div>
        </div>

        <ng-template pTemplate="footer">
          <div class="product-actions">
            <p-button
              icon="pi pi-pencil"
              styleClass="p-button-rounded p-button-secondary p-button-text"
              (onClick)="onUpdate(product)"
            />
            <p-button
              icon="pi pi-trash"
              styleClass="p-button-rounded p-button-danger p-button-text"
              (onClick)="onDelete(product)"
            />
          </div>
        </ng-template>
      </p-card>
      }
    </div>
  </ng-template>
</p-dataView>

<p-dialog
  [(visible)]="isDialogVisible"
  [style]="{ width: '50vw' }"
  header="Ajout/Edition produit"
>
  <app-product-form
    [product]="editedProduct()"
    (save)="onSave($event)"
    (cancel)="onCancel()"
  />
</p-dialog>
